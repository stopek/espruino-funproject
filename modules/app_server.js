function AppServer(b,a){this.port=b||80,this.page=a.page,this.onMessage=a.onMessage||null,this.clients=[]}AppServer.prototype.init=function(){let a=require("ws").createServer(this.server_handler.bind(this));a.on("websocket",this.socket_handler.bind(this)),a.listen(this.port)},AppServer.prototype.broadcast=function(a){this.clients.forEach(b=>b.send(JSON.stringify({broadcast:a})))},AppServer.prototype.server_handler=function(b,a){a.writeHead(200,{"Content-Type":"text/html"}),a.end(this.page)},AppServer.prototype.socket_handler=function(a){this.clients.push(a),console.log("Client connected"),a.on("message",a=>{a=JSON.parse(a),console.log(a);try{this.onMessage&&this.onMessage(a),this.broadcast(a)}catch(b){console.log("Message from client error: "+b.toString())}}),a.on("close",()=>{let b=this.clients.indexOf(a);b> -1&&(this.clients.splice(b,1),console.log("Client disconnected"))})},exports.create=function(b,c){let a=new AppServer(b,c);return a.init(),a}